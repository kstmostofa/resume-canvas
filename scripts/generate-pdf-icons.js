const fs = require("fs");
const path = require("path");

const ICONS_DIR = path.join(
  __dirname,
  "../node_modules/lucide-react/dist/esm/icons",
);
const OUTPUT_FILE = path.join(__dirname, "../lib/pdf-icons.ts");

// Helper to convert kebab-case to PascalCase
const toPascalCase = (str) => {
  return str.replace(/(^\w|-\w)/g, (clear) =>
    clear.replace(/-/, "").toUpperCase(),
  );
};

const generateIcons = () => {
  if (!fs.existsSync(ICONS_DIR)) {
    console.error(`Icons directory not found: ${ICONS_DIR}`);
    process.exit(1);
  }

  const files = fs
    .readdirSync(ICONS_DIR)
    .filter((file) => file.endsWith(".js"));
  const icons = {};

  console.log(`Found ${files.length} icons. Processing...`);

  files.forEach((file) => {
    const content = fs.readFileSync(path.join(ICONS_DIR, file), "utf8");

    // Extract the __iconNode array
    // const __iconNode = [ ... ];
    const match = content.match(/const __iconNode = (\[[\s\S]*?\]);/);

    if (match && match[1]) {
      try {
        // We use eval to parse the JS array/object structure
        // This is safe here because we are reading trusted library files
        const iconNode = eval(match[1]);
        const iconName = toPascalCase(file.replace(".js", ""));
        icons[iconName] = iconNode;
      } catch (e) {
        console.error(`Failed to parse icon ${file}:`, e);
      }
    }
  });

  const outputContent = `// Auto-generated by scripts/generate-pdf-icons.js
// Do not edit manually
// eslint-disable-next-line @typescript-eslint/no-explicit-any
export const pdfIconPack: Record<string, any[]> = ${JSON.stringify(icons, null, 2)};
`;

  fs.writeFileSync(OUTPUT_FILE, outputContent);
  console.log(`Generated ${Object.keys(icons).length} icons in ${OUTPUT_FILE}`);
};

generateIcons();
